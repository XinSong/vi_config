#!/bin/bash

function count()
{
    FIELD=$1
    FILENAME=$2
    awk 'BEGIN{FS="\t";OFS="\t";}
        {sum+=$"'$FIELD'"}
        END{print sum}' $FILENAME
}

function table()
{
    FIELD=$1
    FILENAME=$2
    awk 'BEGIN{FS="\t";OFS="\t";total=0}
        {sum[$"'$FIELD'"]++;total++}
        END{for(i in sum) print i, sum[i], sum[i]*1.0/total}' $FILENAME |
    sort -k2,2n
}

function sample()
{
    RATE=$1
    FILENAME=$2
    FLAG=`expr ${RATE} \< 1`
    if [ ${FLAG} -eq 1 ]
    then 
	awk 'BEGIN{FS="\t";OFS="\t"}
		{
			if(rand()<"'${RATE}'")
				print $0  > "'${FILENAME}'"".train"
			else
				print $0 > "'${FILENAME}'"".test"
		}' ${FILENAME}
    else
        awk 'BEGIN{FS="\t";OFS="\t";sample_number=int("'${RATE}'");}
        {
            if(NR <= sample_number)
                sample_set[NR]=$0
            else if(rand() < sample_number * 1.0 / NR)
                sample_set[int(rand()*sample_number)+1] = $0
        }END{
            for(i in sample_set)
                print sample_set[i]
        }' ${FILENAME}
    fi
}

function oversample()
{
    FIELD=$1
    KEY=$2
    MULTIPLE=$3
    FILENAME=$4
    awk 'BEGIN{FS="\t";OFS="\t"}
        {
            if($"'${FIELD}'" == "'${KEY}'"){
                for(i=1;i<=int("'${MULTIPLE}'");i++)
                    print $0
            }
            else{
                print $0
            }
        }' ${FILENAME} 
}
